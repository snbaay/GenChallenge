<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>GenChallenge - Daily Challenge Generator</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- ✅ ADDED: nice toggle UI (matches your theme variables) -->
    <style>
        .option-group{
            display:flex;
            flex-direction:column;
            gap:10px;
            margin-top:12px;
        }

        .toggle-row{
            display:flex;
            align-items:center;
            justify-content:space-between;
            padding:10px 12px;
            border:1px solid var(--border-color);
            border-radius:10px;
            background:#fff;
            transition: border-color .2s ease, box-shadow .2s ease, transform .12s ease;
        }

        .toggle-row:hover{
            border-color: var(--primary-color);
            box-shadow: 0 6px 18px rgba(0,0,0,0.06);
            transform: translateY(-1px);
        }

        .toggle-text{
            display:flex;
            align-items:flex-start;
            gap:10px;
            color:var(--text-primary);
        }

        .toggle-title{
            font-weight: 700;
            font-size: 0.95rem;
            line-height: 1.2;
        }

        .toggle-sub{
            display:block;
            margin-top:3px;
            color:var(--text-secondary);
            font-weight:500;
            font-size:0.82rem;
            line-height: 1.25;
        }

        /* Hide native checkbox */
        .toggle-row input[type="checkbox"]{
            position:absolute;
            opacity:0;
            width:0;
            height:0;
        }

        /* Switch */
        .switch{
            width:46px;
            height:26px;
            background:#e2e8f0;
            border-radius:999px;
            position:relative;
            transition: all .2s ease;
            flex:0 0 auto;
            box-shadow: inset 0 0 0 1px rgba(0,0,0,0.04);
        }

        .switch::after{
            content:"";
            width:20px;
            height:20px;
            background:#fff;
            border-radius:50%;
            position:absolute;
            top:3px;
            left:3px;
            transition: all .2s ease;
            box-shadow:0 2px 6px rgba(0,0,0,0.18);
        }

        .toggle-row input[type="checkbox"]:checked + .switch{
            background: var(--primary-color);
        }

        .toggle-row input[type="checkbox"]:checked + .switch::after{
            left:23px;
        }

        .toggle-control{
            position:relative;
            display:flex;
            align-items:center;
            gap:10px;
        }

        .toggle-pill{
            font-size: 0.72rem;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 999px;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            background: #fff;
        }

        .toggle-row input[type="checkbox"]:checked ~ .toggle-pill{
            color: var(--primary-color);
            border-color: rgba(99,102,241,0.35);
            background: rgba(99,102,241,0.08);
        }

        /* make Mode select look consistent */
        .mini-select{
            width: 100%;
            margin-top: 6px;
        }
        .mini-label{
            margin-top: 10px;
            display:block;
            font-weight: 600;
            color: var(--text-primary);
        }
    </style>
</head>
<body>
<!-- Header -->
<header class="main-header">
    <div class="header-content">
        <div class="logo">
            <div>
                <h1>GenChallenge</h1>
                <p class="tagline">Daily productivity challenges</p>
            </div>
        </div>
        <nav class="nav-links">
            <a href="#" class="nav-link active">
                <i class="fas fa-bullseye"></i> Today
            </a>
            <a th:href="@{/history}" class="nav-link">
                <i class="fas fa-history"></i> History
            </a>
            <a th:href="@{/stats}" class="nav-link">
                <i class="fas fa-chart-bar"></i> Stats
            </a>
        </nav>
    </div>
</header>

<main class="container">
    <!-- Today's Challenge Card -->
    <div class="card today-card">
        <h2 style="display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-bullseye" style="color: var(--primary-color);"></i> Today's Challenge
        </h2>

        <div th:if="${today != null}">
            <div class="challenge-content">
                <h3 class="challenge-title" th:text="${today.title}">Challenge Title</h3>
                <p class="challenge-desc" th:text="${today.description}">Challenge description will appear here...</p>

                <div class="challenge-meta">
                        <span class="meta-item">
                            <i class="fas fa-tag"></i>
                            <span th:text="${today.type}">Type</span>
                        </span>
                    <span class="meta-item">
                            <i class="fas fa-signal"></i>
                            <span th:text="${today.difficulty}">Difficulty</span>
                        </span>
                    <span class="meta-item">
                            <i class="fas fa-clock"></i>
                            <span th:text="${today.durationMinutes} + ' min'">Duration</span>
                        </span>
                </div>

                <div class="status-badge" th:classappend="${today.completed} ? 'completed' : ''"
                     style="margin-top: 1rem; display: inline-flex; align-items: center; gap: 8px;">
                    <i class="fas" th:classappend="${today.completed} ? 'fa-check-circle' : 'fa-hourglass-half'"></i>
                    <span style="margin-left: 8px;" th:text="${today.completed} ? 'Completed' : 'In Progress'">Status</span>
                </div>
            </div>

            <div class="btn-group" style="margin-top: 1.5rem;">
                <form th:action="@{/complete}" method="post" th:if="${!today.completed}">
                    <button type="submit" class="btn btn-success" style="display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-check"></i> Mark as Completed
                    </button>
                </form>
                <form th:action="@{/generate-daily}" method="post">
                    <button type="submit" class="btn btn-secondary" style="display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-random"></i> New Random Challenge
                    </button>
                </form>
            </div>
        </div>

        <div th:if="${today == null}" class="empty-state" style="text-align: center; padding: 2rem;">
            <i class="fas fa-bullhorn fa-3x" style="color: var(--text-secondary); opacity: 0.3; margin-bottom: 1rem;"></i>
            <h3 style="margin-bottom: 0.5rem; color: var(--text-primary);">No challenge for today</h3>
            <p style="color: var(--text-secondary);">Generate a challenge below to get started!</p>
        </div>
    </div>

    <div class="main-content">
        <!-- Left Column: Create Challenge -->
        <div>
            <div class="card">
                <h3 class="card-title">
                    <i class="fas fa-plus-circle" style="color: var(--primary-color);"></i> Create New Challenge
                </h3>

                <form th:action="@{/generate}" method="post">
                    <div class="form-group">
                        <label for="type" style="display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-tag"></i> Challenge Type
                        </label>
                        <select id="type" name="type" class="select-input" required>
                            <option value="" disabled selected>Choose challenge type</option>
                            <option th:each="t : ${types}"
                                    th:value="${t}"
                                    th:text="${t}"></option>
                        </select>

                        <!-- ✅ Mode (kept, but styled a bit) -->
                        <span class="mini-label">Mode</span>
                        <select name="mode" class="select-input mini-select">
                            <option value="RANDOM_TEMPLATE">Random template</option>
                            <option value="BALANCED_TEMPLATE">Balanced (rare type)</option>
                        </select>

                        <!-- ✅ NEW: toggles styled -->
                        <div class="option-group">

                            <label class="toggle-row">
                                <div class="toggle-text">
                                    <i class="fas fa-clock" style="color: var(--primary-color); margin-top:2px;"></i>
                                    <div>
                                        <div class="toggle-title">Add timer</div>
                                        <span class="toggle-sub">Adds time hint into description</span>
                                    </div>
                                </div>

                                <div class="toggle-control">
                                    <input type="checkbox" name="addTimer" value="true">
                                    <span class="switch"></span>
                                </div>
                            </label>

                            <label class="toggle-row">
                                <div class="toggle-text">
                                    <i class="fas fa-fire" style="color: var(--primary-color); margin-top:2px;"></i>
                                    <div>
                                        <div class="toggle-title">Add motivation</div>
                                        <span class="toggle-sub">Adds short motivational line</span>
                                    </div>
                                </div>

                                <div class="toggle-control">
                                    <input type="checkbox" name="addMotivation" value="true">
                                    <span class="switch"></span>

                                </div>
                            </label>

                        </div>
                    </div>

                    <div class="form-group">
                        <label for="difficulty" style="display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-signal"></i> Difficulty Level
                        </label>
                        <select id="difficulty" name="difficulty" class="select-input" required>
                            <option value="" disabled selected>Choose difficulty</option>
                            <option th:each="d : ${difficulties}"
                                    th:value="${d}"
                                    th:text="${d}"></option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <i class="fas fa-magic"></i> Generate Custom Challenge
                    </button>
                </form>

                <!-- Quick Actions -->
                <div style="margin-top: 1.5rem; border-top: 1px solid var(--border-color); padding-top: 1.5rem;">
                    <form th:action="@{/generate-daily}" method="post" style="width: 100%;">
                        <button type="submit" class="btn" style="width: 100%; background: var(--primary-color); color: white; border: none; padding: 10px; border-radius: 8px; display: flex; align-items: center; justify-content: center; gap: 8px;">
                            <i class="fas fa-random"></i> Quick Random Challenge
                        </button>
                    </form>
                </div>
            </div>

            <!-- Progress Card -->
            <div class="card">
                <h3 class="card-title">
                    <i class="fas fa-chart-line" style="color: var(--primary-color);"></i> Today's Progress
                </h3>
                <div th:if="${today != null}">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin: 1rem 0;">
                        <span>Completion</span>
                        <span th:text="${today.completed} ? '100%' : '0%'">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" th:style="${today.completed} ? 'width: 100%;' : 'width: 0%;'"></div>
                    </div>
                </div>
                <div th:if="${today == null}" style="text-align: center; padding: 1rem; color: var(--text-secondary);">
                    <i class="fas fa-chart-pie fa-2x" style="opacity: 0.5; margin-bottom: 0.5rem;"></i>
                    <p>Generate a challenge to track progress</p>
                </div>
            </div>
        </div>

        <!-- Right Column: Recent Challenges -->
        <div>
            <div class="card">
                <h3 class="card-title">
                    <i class="fas fa-tasks" style="color: var(--primary-color);"></i> Recent Challenges
                </h3>

                <div th:if="${records == null or records.empty}" class="empty-state" style="text-align: center; padding: 2rem;">
                    <i class="fas fa-clipboard-list fa-3x" style="color: var(--text-secondary); opacity: 0.3; margin-bottom: 1rem;"></i>
                    <h3 style="margin-bottom: 0.5rem; color: var(--text-primary);">No challenges yet</h3>
                    <p style="color: var(--text-secondary);">Ready to conquer the day? Add your first challenge above!</p>
                </div>

                <div th:if="${records != null and not records.empty}">
                    <div style="display: grid; gap: 0.75rem;">
                        <div th:each="rec, stat : ${records}" th:if="${stat.index < 5}"
                             style="background: #f8fafc; border-radius: 8px; padding: 1rem; border: 1px solid var(--border-color);">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div>
                                    <div style="font-weight: 600; color: var(--text-primary);" th:text="${rec.title}">Challenge Title</div>
                                    <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.25rem; display: flex; align-items: center; gap: 8px;">
                                        <span th:text="${rec.type}">Type</span>
                                        <span>•</span>
                                        <span th:text="${rec.durationMinutes} + ' min'">Duration</span>
                                    </div>
                                </div>
                                <div>
                                        <span th:if="${rec.completed}"
                                              style="background: #10b981; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.75rem; font-weight: 500;">
                                            <i class="fas fa-check"></i> Done
                                        </span>
                                    <span th:unless="${rec.completed}"
                                          style="background: #f59e0b; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.75rem; font-weight: 500;">
                                            <i class="fas fa-clock"></i> Pending
                                        </span>
                                </div>
                            </div>
                            <div style="margin-top: 0.5rem; font-size: 0.9rem; color: var(--text-secondary);" th:text="${rec.description}"></div>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color);">
                        <a th:href="@{/history}" class="btn btn-secondary" style="display: inline-flex; align-items: center; gap: 8px;">
                            <i class="fas fa-history"></i> View Full History
                        </a>
                    </div>
                </div>
            </div>

            <!-- Stats Preview -->
            <div class="card">
                <h3 class="card-title">
                    <i class="fas fa-chart-pie" style="color: var(--primary-color);"></i> Quick Stats
                </h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                    <div style="text-align: center; padding: 1rem; background: #f1f5f9; border-radius: 8px; border: 1px solid var(--border-color);">
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary-color);"
                             th:text="${records != null ? records.size() : 0}">0</div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">Total Challenges</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: #f1f5f9; border-radius: 8px; border: 1px solid var(--border-color);">
                        <div style="font-size: 1.5rem; font-weight: 700; color: #10b981;"
                             th:text="${records != null ? #aggregates.sum(records.![completed == true ? 1 : 0]) : 0}">0</div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">Completed</div>
                    </div>
                </div>
                <div style="margin-top: 1rem;">
                    <a th:href="@{/stats}" class="btn" style="width: 100%; background: transparent; border: 1px solid var(--border-color); color: var(--primary-color); display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <i class="fas fa-chart-bar"></i> View Detailed Statistics
                    </a>
                </div>
            </div>
        </div>
    </div>
</main>

<footer style="text-align: center; padding: 2rem; color: var(--text-secondary); margin-top: 3rem; border-top: 1px solid var(--border-color);">
    <p style="font-size: 0.9rem;">GenChallenge © 2024</p>
    <p style="font-size: 0.85rem; margin-top: 0.5rem; opacity: 0.8;">Daily productivity challenges for consistent growth</p>
</footer>
</body>
</html>
